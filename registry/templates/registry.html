{% extends 'base.html' %}
{% block main_content %}

<article class="prose-section__main">
    <div class="prose">
        <section class="prose__section">
          <p>
            <strong>{{ num_of_publishers }} organisations are publishing grants data to the 360Giving open data standard.</strong>
          </p>
          <p>
            This means they are sharing information about their grantmaking in a way which allows others to
            use it easily and for free. You can use the table below to download datasets from these organisations.
            You will see that each dataset has its own license attached to it. These licenses specify how the data
            can be shared and used. The data in these spreadsheets is used and displayed by a growing number of
            tools and websites. If you are looking for examples of what can be created using this data,
            please visit the <a href="http://www.threesixtygiving.org/data/find-data/" target="_blank">Tools &amp; Projects</a>
            page.
          </p>
          <p class="devs-info">
            <strong>Developers:</strong> For a JSON feed of published datasets visit
            <a href="http://standard.threesixtygiving.org/en/latest/getdata/" target="_blank">
              http://standard.threesixtygiving.org/en/latest/getdata/</a>
          </p>
          <p>
            Using our templates you can publish data directly on your own website, keeping you in control.
            By registering your data with 360Giving, it becomes easier for others to find, analyse and re-use.
            If you would like to find out about the free support we can provide to help you publish your grants data,
            please <a href="http://www.threesixtygiving.org/contact/" target="_blank">contact us</a>.
          </p>
          <p class="p_smaller_font_size">
            <strong><sub>*</sub></strong>
            Funders make grants in different currencies. Grants are listed in the currency in which they were made.
          </p>
        </section>
    </div>      
</article>

<ul class="list-section">
      
  {% if data %}
    {% for org_prefix, pub in data.items() %}
    <li class="list-section__item" id="{{ org_prefix }}">
      <article class="registry-card" title="{{ pub.publisher.name }}">
        <div class="registry-card__pub-logo">
            <a href="{{ pub.publisher.website }}" target="_blank">
            {% if pub.publisher.logo %}
              <img src="{{ pub.publisher.logo }}" alt="{{ pub.publisher.name }}">
            {% endif %}
            </a>
        </div>
        <div class="registry-card__content">
          <h3 class="registry-card__pub-name">{{ pub.publisher.name }}</h3>
          
          <ul class="registry-card__list">

            <li class="registry-card__item ">
              <table class="registry-grant">
                {% for grant in pub.grant %}
                  <tr class="registry-grant__line">
                    {# <td class="registry-grant__date-range">Records from {{ grant.period.first_date }} to {{ grant.period.latest_date }}</td> #}
                    <td class="registry-grant__date-range">{{grant.file.title }}</td>
                    <td class="registry-grant__records">
                      {% if grant.records %}
                      Records
                      <span class="registry-grant__grant-n">{{grant.records}}</span>
                      {% endif %}
                    </td>
                    <td class="registry-grant__amount">
                      {% for value in grant['total_value']%}
                        {% set value_split = value.split(" ") %}
                        <div>
                          {{value_split[0] | safe}}
                          <span class="registry-grant__amount-n">{{ value_split[1] | safe }}</span>
                        </div>
                      {% endfor %}
                    </td>
                    <td class="registry-grant__download">
                      <a download
                        href="{{grant.file.url}}"
                        title="{{grant.file.title}}">
                        <img src="{{ url_for('.static', filename='images/files/{}.png'.format(grant['file']['type']) )}}"
                             style="width: 32px;height: 32px;max-width: 48px;">
                        {# <i class="material-icons">cloud_download</i> #}
                      </a>
                    </td>  
                  </tr>
                  <tr class="registry-grant__line">
                    <td class="registry-grant__pub-date">Published {{ grant.issued_date }}</td>
                    {% if grant.valid %}
                    <td class="registry-grant__validation registry-grant--validated">
                      Data Validated
                      <i class="material-icons">check_circle_outline</i>
                    </td>
                    {% else %}
                    <td class="registry-grant__validation registry-grant--invalid">
                      Data Invalid
                      <i class="material-icons">highlight_off</i>
                    </td>
                    {% endif %}
                    <td class="registry-grant__license">
                      <a href="{{grant.licence.url}}" target="_blank">
                      {% if grant.licence.name == "Creative Commons Attribution 4.0 International (CC BY 4.0)" %}
                        
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/creative-commons-main.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Creative Commons Attribution 4.0" %}
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/creative-commons-main.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Creative Commons Attribution Share-Alike 4.0" %}
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/creative-commons-main.svg') }}" alt="{{grant.licence.name}}">
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/Cc-sa.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "CCO" %}
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/Cc-zero.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Open Data Commons Public Domain Dedication and Licence 1.0" %}
                        <img class="license license--pddl" src="{{ url_for('.static', filename='images/licences/pddl.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Open Government Licence 3.0 (United Kingdom)" %}
                        <img class="license license--ogl" src="{{ url_for('.static', filename='images/licences/UKOpenGovernmentLicence.svg') }}" alt="{{grant.licence.name}}">
                      {% endif %}
                      </a>
                    </td>
                    <td class="registry-grant__spacer"></td>
                  </tr>
                {% endfor %}  
              </table>
            </li>
          </ul>
        </div>
      </article>

    </li>
    {% endfor %}
  {% endif %}

  </ul>
</div>

{# <table class="table table-bordered text-center">
  <thead>
    <tr>
      <th scope="col">Organisation</th>
      <th scope="col">Title</th>
      <th scope="col">Published</th>
      <th scope="col">Valid?</th>
      <th scope="col">Period</th>
      <th scope="col">Records</th>
      <th scope="col">Total value<sup>*</sup></th>
      <th scope="col">File</th>
      <th scope="col">Licence</th>
    </tr>
  </thead>

  <tbody>
    {% if data %}
      {% for org_prefix, org_data in data.items() %}
        <tr>
          <td scope="rowgroup" rowspan="{{ org_data['grant'] | length }}">
            <div>{{ org_data['publisher']['name'] }}</div>
            <div class="mt-4">
              {% if org_data['publisher']['logo'] %}
                <img class="tlogo" src="{{ org_data['publisher']['logo'] }}" width="100">
              {% endif %}
            </div>
          </td>
          {% if org_data['grant'] %}
            <td>{{ org_data['grant'][0]['file']['title'] }}</td>
            <td style="white-space:nowrap;">{{ org_data['grant'][0]['issued_date'] }}</td>
            <td>{{ org_data['grant'][0]['valid'] | safe }}</td>
            <td>
              <div style="white-space:nowrap;">{{ org_data['grant'][0]['period']['first_date'] }}</div>
              <div>to</div>
              <div style="white-space:nowrap;">{{ org_data['grant'][0]['period']['latest_date'] }}</div>
            </td>
            <td>{{ org_data['grant'][0]['records'] }}</td>
            <td>
              {% for value in org_data['grant'][0]['total_value'] %}
                <div>{{ value | safe }}</div>
              {% endfor %}
            </td>
            <td>
              {% if org_data['grant'][0]['file']['available'] %}
                <div>
                  <a href="{{ org_data['grant'][0]['file']['url'] }}">
                    <img src="../images/files/{{ org_data['grant'][0]['file']['type'] }}.png" width="70" height="70">
                  </a>
                </div>
                <div class="mt-4">{{ org_data['grant'][0]['file']['size'] }}</div>
              {% endif %}
            </td>
            <td>{{ org_data['grant'][0]['licence'] | safe }}</td>
          {% endif %}
        </tr>
        {% if org_data['grant'] | length > 1%}
          {% for grant in org_data['grant'][1:] %}
            <tr>
              <td scope="row">{{ grant['file']['title'] }}</td>
              <td scope="row" style="white-space:nowrap;">{{ grant['issued_date'] }}</td>
              <td scope="row">{{ grant['valid'] | safe }}</td>
              <td scope="row">
                <div style="white-space:nowrap;">{{ grant['period']['first_date'] }}</div>
                <div>to</div>
                <div style="white-space:nowrap;">{{ grant['period']['latest_date'] }}</div>
              </td>
              <td scope="row">{{ grant['records'] }}</td>
              <td scope="row">
                {% for value in grant['total_value']%}
                  <div>{{ value | safe }}</div>
                {% endfor %}
              </td>
              <td>
                {% if org_data['grant'][0]['file']['available'] %}
                  <div>
                    <a href="{{ grant['file']['url'] }}">
                      <img src="../images/files/{{ grant['file']['type'] }}.png" width="70" height="70">
                    </a>
                  </div>
                  <div class="mt-4">{{ grant['file']['size'] }}</div>
                {% endif %}
              </td>
              <td scope="row">{{ grant['licence'] | safe }}</td>
            </tr>
          {% endfor %}
        {% endif %}
      {% endfor %}
    {% endif %}
  </tbody>
</table> #}

{% endblock %}