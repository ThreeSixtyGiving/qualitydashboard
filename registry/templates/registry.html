{% extends 'base.html' %}
{% block main_content %}

<article class="prose-section__main">
  <div class="prose">
    <div class="accordion">
      <section class="prose__section grid grid--three-columns">
        <div class="grid__1">
          <div class="box box--orange">
            <p>
              If you want to explore the grants data by location, sector or recipient, head to 
              <a href="http://grantnav.threesixtygiving.org/" target="_blank">GrantNav</a>.
            </p>
            <p>
              You can use GrantNav to search, compare and download the data for free.
            </p>
          </div>
        </div>
        <div class="grid__2">
          <p>
            This registry lists all {{ num_of_publishers }} organisations that currently publish data about their grants to the 360Giving data
            standard.
          </p>
          <p>
            This registry is useful if you want to see a full list of funders who publish to the standard, or if you want to access
            the data in a machine-readable format to use in research, tools or websites.
          </p>
          <p>
            You can find examples of what can be
            created using this open grants data on the <a href="http://www.threesixtygiving.org/data/find-data/" target="_blank">Tools &amp; Projects</a>
            page.
          </p>
          <button class="accordion__trigger button button--small button--teal">More Information</button>
          <div class="accordion__extra">
            <p class="p">
              Under each organisation, you can find:
            </p>
            <ul class="ul">
              <li class="li">a short description of the data they have published</li>
              <li class="li">the date they last published</li>
              <li class="li">links to download the data and visit their original data source</li>
              <li class="li">the licence they have published the data with (which affects how you can use it)</li>
              <li class="li">the value of the grants they have published data about</li>
            </ul>
            <div class="box box--teal">
              <h3 class="box__heading">Developers</h3>
              <p>For a JSON feed of published datasets visit
              <a href="http://standard.threesixtygiving.org/en/latest/getdata/" target="_blank">
                http://standard.threesixtygiving.org/en/latest/getdata/</a>
              </p>
            </div>
            <p>
              If you are a funder and would like to understand how to publish your grants data openly with the 360Giving data
              standard, visit our <a href="https://www.threesixtygiving.org/support/" target="_blank">support page</a> or 
              <a href="http://www.threesixtygiving.org/contact/" target="_blank">get in touch</a>.
            </p>
            <p>
              <small>
                *Funders make grants in different currencies. Grants are listed in the currency in which they were made.
              </small>
            </p>
          </div>
        </section>
      </div>
    </div>      
</article>

<ul class="card-list">
      
  {% if data %}
    {% for org_prefix, pub in data.items() %}
    <li class="card-list__item" id="{{ org_prefix }}">
      <article class="registry-card">
        <div class="registry-card__pub-logo">
            <a href="{{ pub.publisher.website }}" target="_blank">
            {% if pub.publisher.logo %}
              <img src="{{ pub.publisher.logo }}" alt="{{ pub.publisher.name }}">
            {% endif %}
            </a>
        </div>
        <div class="registry-card__content">
          <h3 class="registry-card__pub-name">
            {# <a href="{{ pub.publisher.website }}" target="_blank"> #}
            {{ pub.publisher.name }}
            {# </a> #}
          </h3>
          
          <ul class="registry-card__list">

            <li class="registry-card__item ">
              <table class="registry-grant">
                {% for grant in pub.grant %}
                  <tr class="registry-grant__line registry-grant--title-line">
                    <td class="registry-grant__title" colspan="3">{{ grant.file.title }}</td>
                  </tr>

                  <tr class="registry-grant__line registry-grant--amounts-line">
                    <td class="registry-grant__pub-date">Published {{ grant.issued_date }}</td>
                    <td class="registry-grant__records">
                      {% if grant.records %}
                      Records
                      <span class="registry-grant__grant-n">{{grant.records}}</span>
                      {% endif %}
                    </td>
                    <td class="registry-grant__amount">
                      {% for value in grant['total_value']%}
                        {% set value_split = value.split(" ", maxsplit=1) %}
                        <div>
                          {{value_split[0] | safe}}
                          <span class="registry-grant__amount-n">{{ value_split[1] | safe }}</span>
                        </div>
                      {% endfor %}
                    </td>
                  </tr>
                  <tr class="registry-grant__line registry-grant--data-line">
                    <td class="registry-grant__download">
                      {% if grant.file.type.lower() == 'excel' %}
                      <a class="registry-grant__file registry-grant--xls"  href="{{grant.file.url}}" download title="Excel Spreadsheet - {{grant.file.size}}">Excel - {{grant.file.size}}</a>
                      {% elif grant.file.type.lower() == 'csv' %}
                      <a class="registry-grant__file registry-grant--csv"  href="{{grant.file.url}}" download title="JSON - {{grant.file.size}}">CSV - {{grant.file.size}}</a>
                      {% elif grant.file.type.lower() == 'json' %}
                      <a class="registry-grant__file registry-grant--json" href="{{grant.file.url}}" download title="Comma Separated Values - {{grant.file.size}}">JSON - {{grant.file.size}}</a>
                      {% elif grant.file.type.lower() == 'ods' %}
                      <a class="registry-grant__file registry-grant--ods"  href="{{grant.file.url}}" download title="Open Document Spreadsheet - {{grant.file.size}}">ODS - {{grant.file.size}}</a>
                      {% endif %}
                    </td>
                    {% if grant.valid %}
                    <td class="registry-grant__validation registry-grant--validated">
                      Valid data
                      <i class="material-icons">
                        {# <a href="https://dataquality.threesixtygiving.org/?source_url={{ grant.file.url | urlencode }}" 
                           target="_blank"
                           title="View this file on the data quality tool"> #}
                          check_circle_outline
                        {# </a> #}
                      </i>
                    </td>
                    {% else %}
                    <td class="registry-grant__validation registry-grant--invalid">
                      Invalid data
                      <i class="material-icons">
                        {# <a href="https://dataquality.threesixtygiving.org/?source_url={{ grant.file.url | urlencode }}" 
                           target="_blank"
                           title="View this file on the data quality tool"> #}
                          highlight_off
                        {# </a> #}
                      </i>
                    </td>
                    {% endif %}
                    <td class="registry-grant__license">
                      Licence 
                      <a href="{{grant.licence.url}}" target="_blank" title="{{grant.licence.name}}">
                      {% if grant.licence.name == "Creative Commons Attribution 4.0 International (CC BY 4.0)" %}
                        
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/creative-commons-main.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Creative Commons Attribution 4.0" %}
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/creative-commons-main.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Creative Commons Attribution Share-Alike 4.0" %}
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/creative-commons-main.svg') }}" alt="{{grant.licence.name}}">
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/Cc-sa.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "CCO" %}
                        <img class="license license--cc" src="{{ url_for('.static', filename='images/licences/Cc-zero.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Open Data Commons Public Domain Dedication and Licence 1.0" %}
                        <img class="license license--pddl" src="{{ url_for('.static', filename='images/licences/pddl.svg') }}" alt="{{grant.licence.name}}">
                      
                      {% elif grant.licence.name == "Open Government Licence 3.0 (United Kingdom)" %}
                        <img class="license license--ogl" src="{{ url_for('.static', filename='images/licences/UKOpenGovernmentLicence.svg') }}" alt="{{grant.licence.name}}">
                      {% endif %}
                      </a>
                    </td>
                  </tr>
                {% endfor %}  
              </table>
            </li>
          </ul>
        </div>
      </article>

    </li>
    {% endfor %}
  {% endif %}

  </ul>
</div>

{% endblock %}