{% extends 'base.html' %}
{% block main_content %}

<div class = "page-header">
  <h1>DATA REGISTRY</h1>
</div>

<div>
  <p><strong>More than 80 organisations are publishing grants data to the 360Giving open data standard.</strong></p>
  <p>
    This means they are sharing information about their grantmaking in a way which allows others to
    use it easily and for free. You can use the table below to download datasets from these organisations.
    You will see that each dataset has its own license attached to it. These licenses specify how the data
    can be shared and used. The data in these spreadsheets is used and displayed by a growing number of
    tools and websites. If you are looking for examples of what can be created using this data,
    please visit the <a href="http://www.threesixtygiving.org/data/find-data/" target="_blank">Tools &amp; Projects</a>
    page.
  </p>
  <p class="devs-info">
    <strong>Developers:</strong> For a JSON feed of published datasets visit
    <a href="http://standard.threesixtygiving.org/en/latest/getdata/" target="_blank">
      http://standard.threesixtygiving.org/en/latest/getdata/</a>
  </p>
  <p>
    Using our templates you can publish data directly on your own website, keeping you in control.
    By registering your data with 360Giving, it becomes easier for others to find, analyse and re-use.
    If you would like to find out about the free support we can provide to help you publish your grants data,
    please <a href="http://www.threesixtygiving.org/contact/" target="_blank">contact us</a>.
  </p>
</div>

<table class="table table-bordered text-center">
  <thead>
    <tr>
      <th scope="col">Organisation</th>
      <th scope="col">Title</th>
      <th scope="col">Published</th>
      <th scope="col">Valid?</th>
      <th scope="col">Period</th>
      <th scope="col">Records</th>
      <th scope="col">Total value</th>
      <th scope="col">File</th>
      <th scope="col">Licence</th>
    </tr>
  </thead>

  <tbody>
    {% if data %}
      {% for org_prefix, org_data in data.items() %}
        <tr>
          <td scope="rowgroup" rowspan="{{ org_data['grant'] | length }}">
            <div>{{ org_data['publisher']['name'] }}</div>
            <div class="mt-4">
              {% if org_data['publisher']['logo'] %}
                <img class="tlogo" src="{{ org_data['publisher']['logo'] }}" width="100">
              {% endif %}
            </div>
          </td>
          {% if org_data['grant'] %}
            <td>{{ org_data['grant'][0]['file']['title'] }}</td>
            <td style="white-space:nowrap;">{{ org_data['grant'][0]['issued_date'] }}</td>
            <td>{{ org_data['grant'][0]['valid'] | safe }}</td>
            <td>
              <div style="white-space:nowrap;">{{ org_data['grant'][0]['period']['first_date'] }}</div>
              <div>to</div>
              <div style="white-space:nowrap;">{{ org_data['grant'][0]['period']['latest_date'] }}</div>
            </td>
            <td>{{ org_data['grant'][0]['records'] }}</td>
            <td>
              {% for value in org_data['grant'][0]['total_value'] %}
                <div>{{ value | safe }}</div>
              {% endfor %}
            </td>
            <td>
              {% if org_data['grant'][0]['file']['available'] %}
                <div>
                  <a href="{{ org_data['grant'][0]['file']['url'] }}">
                    <img src="../images/files/{{ org_data['grant'][0]['file']['type'] }}.png" width="70" height="70">
                  </a>
                </div>
                <div class="mt-4">{{ org_data['grant'][0]['file']['size'] }}</div>
              {% endif %}
            </td>
            <td>{{ org_data['grant'][0]['licence'] | safe }}</td>
          {% endif %}
        </tr>
        {% if org_data['grant'] | length > 1%}
          {% for grant in org_data['grant'][1:] %}
            <tr>
              <td scope="row">{{ grant['file']['title'] }}</td>
              <td scope="row" style="white-space:nowrap;">{{ grant['issued_date'] }}</td>
              <td scope="row">{{ grant['valid'] | safe }}</td>
              <td scope="row">
                <div style="white-space:nowrap;">{{ grant['period']['first_date'] }}</div>
                <div>to</div>
                <div style="white-space:nowrap;">{{ grant['period']['latest_date'] }}</div>
              </td>
              <td scope="row">{{ grant['records'] }}</td>
              <td scope="row">
                {% for value in grant['total_value']%}
                  <div>{{ value | safe }}</div>
                {% endfor %}
              </td>
              <td>
                {% if org_data['grant'][0]['file']['available'] %}
                  <div>
                    <a href="{{ grant['file']['url'] }}">
                      <img src="../images/files/{{ grant['file']['type'] }}.png" width="70" height="70">
                    </a>
                  </div>
                  <div class="mt-4">{{ grant['file']['size'] }}</div>
                {% endif %}
              </td>
              <td scope="row">{{ grant['licence'] | safe }}</td>
            </tr>
          {% endfor %}
        {% endif %}
      {% endfor %}
    {% endif %}
  </tbody>
</table>

{% endblock %}